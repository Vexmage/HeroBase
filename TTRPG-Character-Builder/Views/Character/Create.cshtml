@model TTRPG_Character_Builder.Models.Character

@{
    ViewData["Title"] = "Create Character";
}

<h2>@ViewData["Title"]</h2>

<form asp-action="Create" method="post">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <!-- Form fields, similar to the provided view, ensure all fields are correctly bound -->
    <div class="form-group">
        <label asp-for="Name" class="control-label">Name</label>
        <input asp-for="Name" class="form-control" />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <!-- The Race and Class dropdowns should be populated from ViewBag -->
    <div class="form-group">
        <label asp-for="RaceId" class="control-label">Race</label>
        <select asp-for="RaceId" asp-items="ViewBag.Races" class="form-control"></select>
        <span asp-validation-for="RaceId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="ClassId" class="control-label">Class</label>
        <select asp-for="ClassId" asp-items="ViewBag.Classes" class="form-control"></select>
        <span asp-validation-for="ClassId" class="text-danger"></span>
    </div>



    <!-- Attributes -->
    <!-- Add a container for the dice rolling animation -->
    <div id="diceAnimationContainer">
        <img src="~/img/dice-roll-dice.gif" alt="Dice Rolling Animation" />
    </div>


    <div class="form-group">
        <label asp-for="Strength" class="control-label">Strength</label>
        <input asp-for="Strength" class="form-control" readonly />
        <button type="button" class="btn btn-secondary" onclick="rollDice('Strength')">Roll for Strength</button>
        <span id="StrengthRollResult"></span>
        <span asp-validation-for="Strength" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Dexterity" class="control-label">Dexterity</label>
        <input asp-for="Dexterity" class="form-control" readonly />
        <button type="button" class="btn btn-secondary" onclick="rollDice('Dexterity')">Roll for Dexterity</button>
        <span id="DexterityRollResult"></span>
        <span asp-validation-for="Dexterity" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Constitution" class="control-label">Constitution</label>
        <input asp-for="Constitution" class="form-control" readonly />
        <button type="button" class="btn btn-secondary" onclick="rollDice('Constitution')">Roll for Constitution</button>
        <span id="ConstitutionRollResult"></span>
        <span asp-validation-for="Constitution" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Intelligence" class="control-label">Intelligence</label>
        <input asp-for="Intelligence" class="form-control" readonly />
        <button type="button" class="btn btn-secondary" onclick="rollDice('Intelligence')">Roll for Intelligence</button>
        <span id="IntelligenceRollResult"></span>
        <span asp-validation-for="Intelligence" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Wisdom" class="control-label">Wisdom</label>
        <input asp-for="Wisdom" class="form-control" readonly />
        <button type="button" class="btn btn-secondary" onclick="rollDice('Wisdom')">Roll for Wisdom</button>
        <span id="WisdomRollResult"></span>
        <span asp-validation-for="Wisdom" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Charisma" class="control-label">Charisma</label>
        <input asp-for="Charisma" class="form-control" readonly />
        <button type="button" class="btn btn-secondary" onclick="rollDice('Charisma')">Roll for Charisma</button>
        <span id="CharismaRollResult"></span>
        <span asp-validation-for="Charisma" class="text-danger"></span>
    </div>

    <!-- End of attribute block -->

    <div class="form-group">
        <label asp-for="Biography" class="control-label">Biography</label>
        <textarea asp-for="Biography" class="form-control"></textarea>
        <span asp-validation-for="Biography" class="text-danger"></span>
    </div>

    <div class="form-group">
        <input type="submit" value="Create" class="btn btn-primary" />
    </div>

    <!-- Animation container -->
    <div id="animationContainer" style="display: none;">
        <img id="animationImage" src="~/images/dice_animation.gif" alt="Dice Animation" />
    </div>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function rollDice(attribute) {
            var rolls = [];
            for (var i = 0; i < 4; i++) {
                rolls.push(Math.floor(Math.random() * 6) + 1);
            }

            rolls.sort((a, b) => b - a);
            rolls.pop(); // Remove the lowest roll
            var total = rolls.reduce((a, b) => a + b, 0);

            document.getElementById(attribute).value = total; // Set the value in the input
            document.getElementById(attribute + 'RollResult').innerHTML = 'Rolled: ' + rolls.join(', ') + ' (Total: ' + total + ')';

            // Trigger the dice rolling animation
            var diceAnimationContainer = document.getElementById('diceAnimationContainer');
            diceAnimationContainer.classList.add('roll-animation');
            setTimeout(() => {
                diceAnimationContainer.classList.remove('roll-animation');
            }, 3000); // Adjust the duration of the animation
        }

    </script>
}
